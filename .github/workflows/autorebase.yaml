name: Autorebase

env:
  BASE_BRANCH: ${{ github.event.repository.default_branch }}
  TARGET_BRANCH: "develop"

on:
  push:
    branches:
      - master

jobs:
  autorebase:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3
        with:
          fetch-depth: 0
          ref: develop
          token: ${{ secrets.USER_TOKEN }}

      - name: Rebase Branch
        if: ${{ env.TARGET_BRANCH != github.event.repository.default_branch }}
        run: |
          git config --global user.email ${{ secrets.USER_EMAIL }}
          git config --global user.name ${{ secrets.USER_NAME }}
          git pull --rebase
          git rebase origin/${{ env.BASE_BRANCH }}
          git push --force-with-lease origin ${{ env.TARGET_BRANCH }}
